<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="js/voting.js"></script>

<% layout('layouts/boilerplate') %>

<div class="container mx-auto px-4 py-4 border-2 mt-8">
    <a class="text-2xl" href="/<%= post._id %>"><%= post.title %></a>
    <p><%= post.text %></p>
    <div class="flex justify-end">
        <p>Username</p>
    </div>
    <p id="postPoints">Points: <%= post.upvotes - post.downvotes %></p>
    <button id="upvoteButton" class="block my-2 bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 hover:border-transparent rounded">Upvote</button>
    <button id="downvoteButton" class="block my-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">Downvote</button>
</div>



<div class="container mx-auto px-4 py-4 border-2 mt-8">
    <form method="POST" action="/<%= post._id %>">
        <div class="my-6">
            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Post Text</label>
            <textarea required name="comment" id="comment" class="block w-full p-4 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 sm:text-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" name="large-input" id="" cols="30" rows="5"></textarea>
        </div>
        <button class="mt-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">Reply</button>
    </form>
</div>

<% for (let i = 0; i < post.comments.length; i++) { %>
    <% const reply = post.comments[i] %>

    <div class="container mx-auto px-4 py-4 border-2 my-8">
        <p><b>Username</b> | <span id="commentScore=<%= reply._id %>"><%= reply.upvotes - reply.downvotes %> points</span></p>
        <p><%= reply.text %></p>

        <button id="upvote=<%= reply._id %>" class="upvoteComment block my-2 bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 hover:border-transparent rounded">Upvote</button>
        <button id="downvote=<%= reply._id %>" class="downvoteComment block my-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">Downvote</button>

        <a class="inline-block mt-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" href="/<%=post._id%>/<%=reply._id%>">View</a>
        <form class="inline-block" method="POST" action="/<%= post._id %>/<%=reply._id%>?_method=DELETE">
            <button class="mt-2 bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 hover:border-transparent rounded">Delete</button>
        </form>
    </div>

    <!-- if there are replies -->
    <% if (repliesToComments[i]) { %> 
        <% for (let reply of repliesToComments[i]) { %>
        <div class="container mx-auto px-4 py-4 my-8">
            <div class="ml-<%=reply.depth * 12%> border-2 px-4 py-4 w-100">
                <p><b>Username</b> | <span id="commentScore=<%= reply._id %>"><%= reply.upvotes - reply.downvotes %> points</span></p>
                <p><%= reply.text %></p>

                <button id="upvote=<%= reply._id %>" class="upvoteComment block my-2 bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 hover:border-transparent rounded">Upvote</button>
                <button id="downvote=<%= reply._id %>" class="downvoteComment block my-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded">Downvote</button>

                <a class="inline-block mt-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" href="/<%=post._id%>/<%=reply._id%>">View</a>
                <form class="inline-block" method="POST" action="/<%= post._id %>/<%=reply._id%>?_method=DELETE">
                    <button class="mt-2 bg-transparent hover:bg-red-500 text-red-700 font-semibold hover:text-white py-2 px-4 border border-red-500 hover:border-transparent rounded">Delete</button>
                </form>
            </div>
        </div>
        <% } %> 
    <% } %> 
<% } %>